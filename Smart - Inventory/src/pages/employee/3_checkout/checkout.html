<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../../styles/content.css">
</head>
<body>
    <div class="content-section">
        <h2>Checkout</h2>
        <p style="color: gray; margin-bottom: 20px;">
            Search for products, add them to your cart, and process the checkout.
        </p>

        <!-- Search and Add Section -->
        <div class="form-row" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
            <input type="text" id="productSearch" placeholder="Search product..." class="filter-input" style="flex: 2;">
            <input type="number" id="productQty" placeholder="Quantity" class="filter-input" style="width: 120px;">
            <button class="submit-button" onclick="addToCart()">Add to Cart</button>
        </div>

        <!-- Cart Table -->
        <table class="data-table" id="cartTable">
            <thead>
                <tr>
                    <th>Product ID</th>
                    <th>Product</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Subtotal</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Cart items will appear here -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="5" class="text-right"><strong>Total:</strong></td>
                    <td id="cartTotal">â‚±0.00</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>

        <!-- Checkout Button -->
        <div style="margin-top: 30px; text-align: right;">
            <button class="submit-button" onclick="processCheckout()">Process Checkout</button>
        </div>

        <div style="height: 50px;"></div>
    </div>

    <script>
        // Temporary sample product data (can be replaced with DB data later)
        const products = [
            { id: "001", name: "Wireless Mouse", category: "Electronics", price: 350 },
            { id: "002", name: "Office Chair", category: "Furniture", price: 1250 },
            { id: "003", name: "Notebook", category: "Office Supplies", price: 35 },
            { id: "004", name: "USB Cable", category: "Electronics", price: 120 },
            { id: "005", name: "LED Lamp", category: "Home Goods", price: 450 }
        ];

        let cart = [];

        function addToCart() {
            const searchInput = document.getElementById("productSearch").value.trim().toLowerCase();
            const qty = parseInt(document.getElementById("productQty").value);

            if (!searchInput) {
                alert("Please type a product name or ID.");
                return;
            }

            if (isNaN(qty) || qty <= 0) {
                alert("Please enter a valid quantity.");
                return;
            }

            // ðŸ” Find matching product by name or ID
            const product = products.find(p =>
                p.name.toLowerCase().includes(searchInput) || p.id.toLowerCase() === searchInput
            );

            if (!product) {
                alert("Product not found!");
                return;
            }

            // Check if already in cart
            const existingItem = cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.qty += qty;
            } else {
                cart.push({ ...product, qty });
            }

            renderCart();

            // Clear input boxes
            document.getElementById("productSearch").value = "";
            document.getElementById("productQty").value = "";
        }

        function renderCart() {
            const tbody = document.querySelector("#cartTable tbody");
            tbody.innerHTML = "";

            let total = 0;

            cart.forEach((item, index) => {
                const subtotal = item.price * item.qty;
                total += subtotal;

                const row = `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>â‚±${item.price.toFixed(2)}</td>
                        <td>${item.qty}</td>
                        <td>â‚±${subtotal.toFixed(2)}</td>
                        <td><button class="cancel-button" onclick="removeFromCart(${index})">Remove</button></td>
                    </tr>
                `;
                tbody.insertAdjacentHTML("beforeend", row);
            });

            document.getElementById("cartTotal").textContent = `â‚±${total.toFixed(2)}`;
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCart();
        }

        function processCheckout() {
            if (cart.length === 0) {
                alert("Your cart is empty!");
                return;
            }

            const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
            alert(`âœ… Checkout successful!\n\nTotal Amount: â‚±${total.toFixed(2)}`);

            // Clear cart after checkout
            cart = [];
            renderCart();
        }

        // Optional: Run once page is loaded
        document.addEventListener("DOMContentLoaded", () => {
            console.log("Employee Checkout page loaded.");
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMS â€“ Employee Panel</title>
    <link rel="stylesheet" href="../../styles/sidebar.css">
    <link rel="stylesheet" href="../../styles/content.css">
    <link rel="stylesheet" href="../../styles/logout-popup.css">
    <link rel="icon" type="image/png" href="../../assets/SIMS.png">
    <style>
        /* Same fade animation switching pages*/
        #main-content {
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        #main-content.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- === SIDEBAR TOGGLE === -->
    <div class="sidebar-toggle" id="sidebarToggle">&#9776;</div>

    <!-- === SIDEBAR === -->
    <div class="sidebar">
        <a href="#" onclick="loadContent('dashboard', '1_dashboard')">
            <img src="../../assets/dashboard.white.png" alt="Dashboard Icon">
            <span>Dashboard</span>
        </a>
        <a href="#" onclick="loadContent('products', '2_products')">
            <img src="../../assets/white.png" alt="Products Icon">
            <span>Products</span>
        </a>
        <a href="#" onclick="loadContent('checkout', '3_checkout')">
            <img src="../../assets/checkout.white.png" alt="Checkout Icon">
            <span>Checkout</span>
        </a>
        <a href="#" onclick="loadContent('transactions', '4_transactions')">
            <img src="../../assets/transaction.white.png" alt="Transactions Icon">
            <span>Transaction History</span>
        </a>
        <a href="#" onclick="loadContent('settings', '7_settings')">
            <img src="../../assets/setting.white.png" alt="Setting Icon">
            <span>Settings</span>
        </a>
        <a href="#" class="logout" onclick="showLogoutPopup()">
            <img src="../../assets/exit.white.png" alt="Logout Icon">
            <span>Logout</span>
        </a>
    </div>

    <!-- === MAIN CONTENT === -->
    <div class="content" id="main-content"></div>

    <!-- === LOGOUT POPUP === -->
    <div class="logout-popup" id="logoutPopup">
        <div class="logout-box">
            <h3>Are you sure you want to log out?</h3>
            <div class="logout-buttons">
                <button class="yes" onclick="confirmLogout()">Yes</button>
                <button class="no" onclick="closeLogoutPopup()">No</button>
            </div>
        </div>
    </div>

    <!-- === JAVASCRIPT === -->
    <script>
        async function loadContent(section, folder) {
            const content = document.getElementById("main-content");
            content.classList.remove("visible");
            content.innerHTML = `<div class="content-section"><h2>Loading ${section}...</h2></div>`;

            try {
                const response = await fetch(`${folder}/${section}.html`);
                if (!response.ok) throw new Error(`Failed to load ${section}.html`);
                const html = await response.text();

                // Smooth fade effect
                content.style.opacity = 0;
                setTimeout(() => {
                    content.innerHTML = html;
                    content.style.opacity = 1;
                    content.classList.add("visible");

                    localStorage.setItem("currentSection", section);
                    localStorage.setItem("currentFolder", folder);
                }, 200);

                // Remove old section scripts
                document.querySelectorAll("script[data-section]").forEach(s => s.remove());

                // Load section-specific JS if needed
                const sectionsWithJS = ['dashboard', 'products', 'checkout', 'transactions'];
                if (sectionsWithJS.includes(section)) {
                    const script = document.createElement("script");
                    script.src = `${folder}/${section}.js`;
                    script.setAttribute("data-section", section);
                    document.body.appendChild(script);
                }

                // Highlight active sidebar link
                setActiveLink(section);
            } catch (error) {
                content.innerHTML = `<div class="content-section"><h2>Error loading ${section}</h2><p>${error.message}</p></div>`;
                content.classList.add("visible");
            }
        }

        // Default load
        document.addEventListener("DOMContentLoaded", () => {
            const lastSection = localStorage.getItem("currentSection") || "dashboard";
            const lastFolder = localStorage.getItem("currentFolder") || "1_dashboard";
            loadContent(lastSection, lastFolder);
        });

        // === LOGOUT POPUP ===
        function showLogoutPopup() {
            document.getElementById("logoutPopup").classList.add("active");
        }
        function closeLogoutPopup() {
            document.getElementById("logoutPopup").classList.remove("active");
        }
        function confirmLogout() {
            document.body.style.transition = "opacity 0.5s ease";
            document.body.style.opacity = 0;
            setTimeout(() => {
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = "../../login/login.html";
            }, 500);
        }
    </script>

    <script src="../../scripts/sidebar.js"></script>
</body>
</html>
